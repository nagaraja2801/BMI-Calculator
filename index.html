<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BMI Calculator</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f4f8;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      padding: 1rem;
    }
    .container {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      width: 360px;
      max-width: 100%;
      text-align: center;
    }
    h2, h3 {
      margin-bottom: 1rem;
    }
    label {
      display: block;
      text-align: left;
      font-weight: 600;
      margin-bottom: 0.25rem;
      margin-top: 0.5rem;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-bottom: 0.25rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1rem;
      box-sizing: border-box;
    }
    .result, #calorieResults {
      margin-top: 1rem;
      font-size: 1rem;
    }
    button {
      background-color: #007BFF;
      color: white;
      border: none;
      padding: 10px 0;
      width: 100%;
      font-size: 1rem;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 1rem;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>BMI Calculator</h2>

    <div id="authSection">
      <h3>ðŸ‘¤ Login (Optional)</h3>
      <label for="username">Username</label>
      <input type="text" id="username" placeholder="Enter username" />
      <label for="password">Password</label>
      <input type="password" id="password" placeholder="Enter password" />
      <button onclick="login()">Login / Register</button>
      <div id="authMessage" style="margin-top: 10px;"></div>
    </div>

    <div id="calorieMacroSection" style="margin-top:2rem; text-align:left;">
      <h3>ðŸŽ¯ Calorie & Macro Calculator</h3>
      <label for="age">Age</label>
      <input type="number" id="age" placeholder="Enter your age" />
      <label for="gender">Gender</label>
      <select id="gender">
        <option value="" disabled selected>Select gender</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select>
      <label for="activity">Activity Level</label>
      <select id="activity">
        <option value="" disabled selected>Select activity level</option>
        <option value="1.2">Sedentary (little or no exercise)</option>
        <option value="1.375">Lightly active (1-3 days/week)</option>
        <option value="1.55">Moderately active (3-5 days/week)</option>
        <option value="1.725">Very active (6-7 days/week)</option>
        <option value="1.9">Extra active (hard training)</option>
      </select>
      <label for="cmHeight">Height</label>
      <div style="display: flex; gap: 8px;">
        <input type="number" id="cmHeight" placeholder="Height" />
        <select id="heightUnit" onchange="convertHeight()">
          <option value="cm">cm</option>
          <option value="in">in</option>
        </select>
      </div>
      <label for="kgWeight">Weight</label>
      <div style="display: flex; gap: 8px;">
        <input type="number" id="kgWeight" placeholder="Weight" />
        <select id="weightUnit" onchange="convertWeight()">
          <option value="kg">kg</option>
          <option value="lb">lb</option>
        </select>
      </div>
      <label for="wrist">Wrist Circumference (optional, cm)</label>
      <input type="number" id="wrist" placeholder="Optional - for body fat %" />
      <button onclick="calculateCalories()">Calculate Daily Calories</button>
      <div id="calorieResults"></div>
    </div>
  </div>

  <script>
    let loggedInUser = null;

    function login() {
      const user = document.getElementById('username').value.trim();
      const pass = document.getElementById('password').value.trim();
      if (!user || !pass) {
        document.getElementById('authMessage').innerText = "Username and password are required.";
        return;
      }
      const stored = JSON.parse(localStorage.getItem(`user_${user}`));
      if (stored && stored.password !== btoa(pass)) {
        document.getElementById('authMessage').innerText = "Incorrect password.";
        return;
      }
      if (!stored) {
        localStorage.setItem(`user_${user}`, JSON.stringify({ password: btoa(pass), history: [] }));
        document.getElementById('authMessage').innerText = "Account created and logged in.";
      } else {
        document.getElementById('authMessage').innerText = "Logged in successfully.";
      }
      loggedInUser = user;
      showHistory();
    }

    function saveUserData(result) {
      if (!loggedInUser) return;
      const data = JSON.parse(localStorage.getItem(`user_${loggedInUser}`));
      const date = new Date().toLocaleString();
      data.history.push({ date, ...result });
      localStorage.setItem(`user_${loggedInUser}`, JSON.stringify(data));
    }

    function showHistory() {
      const container = document.querySelector('.container');
      const data = JSON.parse(localStorage.getItem(`user_${loggedInUser}`));
      if (!data || !data.history.length) return;
      const html = data.history.map(h =>
        `<li><strong>${h.date}</strong>: ${h.maintenance} kcal (BMI: ${h.bmi || "N/A"})</li>`
      ).join('');
      // Remove old history if present to avoid duplicates
      const oldSection = document.getElementById('historySection');
      if (oldSection) oldSection.remove();
      const section = document.createElement('div');
      section.id = 'historySection';
      section.innerHTML = `<h3>Your History</h3><ul style="text-align:left;">${html}</ul>`;
      container.appendChild(section);
    }

    function convertHeight() {
      const input = document.getElementById('cmHeight');
      const unit = document.getElementById('heightUnit').value;
      let value = parseFloat(input.value);
      if (isNaN(value)) return;
      if (unit === 'in') {
        input.value = (value / 2.54).toFixed(2);
      } else {
        input.value = (value * 2.54).toFixed(2);
      }
    }

    function convertWeight() {
      const input = document.getElementById('kgWeight');
      const unit = document.getElementById('weightUnit').value;
      let value = parseFloat(input.value);
      if (isNaN(value)) return;
      if (unit === 'lb') {
        input.value = (value / 0.453592).toFixed(2);
      } else {
        input.value = (value * 0.453592).toFixed(2);
      }
    }

    function calculateCalories() {
      const age = parseInt(document.getElementById('age').value);
      const gender = document.getElementById('gender').value;
      const activity = parseFloat(document.getElementById('activity').value);
      let height = parseFloat(document.getElementById('cmHeight').value);
      if (document.getElementById('heightUnit').value === 'in') height *= 2.54;
      let weight = parseFloat(document.getElementById('kgWeight').value);
      if (document.getElementById('weightUnit').value === 'lb') weight *= 0.453592;

      if (!age || !gender || !activity || !height || !weight) {
        document.getElementById('calorieResults').innerHTML = "<span style='color: red;'>Please enter all required fields.</span>";
        return;
      }

      const bmr = gender === 'male'
        ? 10 * weight + 6.25 * height - 5 * age + 5
        : 10 * weight + 6.25 * height - 5 * age - 161;

      const tdee = bmr * activity;
      const protein = weight * 2;
      const fat = weight * 0.8;
      const carbs = (tdee - (protein * 4 + fat * 9)) / 4;

      // BMI calculation
      const heightM = height / 100;
      const bmi = (weight / (heightM * heightM)).toFixed(2);

      let bodyFat = "N/A";
      const wrist = parseFloat(document.getElementById('wrist').value);
      if (!isNaN(wrist) && wrist > 0) {
        if (gender === 'female') {
          const wristCm = wrist;
          const waist = 70; // Placeholder for now, you can add more inputs
          const hip = 90;
          const forearm = 20;
          // Simplified estimate
          bodyFat = (163.205 * Math.log10(waist + hip - wrist) - 97.684 * Math.log10(height) - 78.387).toFixed(2);
        } else {
          // Male body fat estimate, placeholder formula
          bodyFat = (495 / (1.0324 - 0.19077 * Math.log10(wrist) + 0.15456 * Math.log10(height)) - 450).toFixed(2);
        }
      }

      const resultText = `
        <strong>Maintenance Calories (TDEE):</strong> ${tdee.toFixed(0)} kcal<br/>
        <strong>Protein:</strong> ${protein.toFixed(0)} g/day<br/>
        <strong>Fat:</strong> ${fat.toFixed(0)} g/day<br/>
        <strong>Carbohydrates:</strong> ${carbs.toFixed(0)} g/day<br/>
        <strong>BMI:</strong> ${bmi}<br/>
        <strong>Estimated Body Fat %:</strong> ${bodyFat}
      `;

      document.getElementById('calorieResults').innerHTML = resultText;

      saveUserData({ maintenance: tdee.toFixed(0), bmi, protein: protein.toFixed(0), fat: fat.toFixed(0), carbs: carbs.toFixed(0), bodyFat });

      if (loggedInUser) showHistory();
    }
  </script>
</body>
</html>
